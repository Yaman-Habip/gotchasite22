<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>
    gotcha22
  </title>
  <link rel="stylesheet" type="text/css" href="/public/style.css" />
</head>

<body>
  <div>
    <p id = "target" type = "text">placeholder </p>
    <input id = "last_words" type = "text" placeholder = "last words">
    <button id = "tag_out">
      Tag Out
    </button>
  </div>
  <script type="module">

  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.13.0/firebase-analytics.js";
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyDJcTBXZZcw1hpWAyith3HtPBZRAx7vkvE",
    authDomain: "gotcha-b4b13.firebaseapp.com",
    databaseURL: "https://gotcha-b4b13-default-rtdb.firebaseio.com",
    projectId: "gotcha-b4b13",
    storageBucket: "gotcha-b4b13.appspot.com",
    messagingSenderId: "628191290317",
    appId: "1:628191290317:web:630903a8d98f8cc19e9a84",
    measurementId: "G-LG5MKGL41Y"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);

  import {getFirestore, doc, getDoc, setDoc, collection, addDoc, updateDoc, deleteDoc, deleteField}
  from "https://www.gstatic.com/firebasejs/9.13.0/firebase-firestore.js";

  const db = getFirestore();

  let tag_out = document.getElementById('tag_out');
  let target = document.getElementById('target');
  let uid = "yaman_habip23@milton.edu";

//tag person out

  async function tag_out_func(){
    let last_words = document.getElementById('last_words');
    var ref = doc(db, "data", uid);
    const docRef = await updateDoc(
      ref, {
        alive: false,
        lastWords: last_words.value
      }
    )
    .then(()=> {alert("You have tagged out")})
    .catch((error)=> {console.log(error)})

  //info about person tagging out

    const docSnap = await getDoc(ref);
    if (docSnap.exists()) {
        var chaser = docSnap.data()["chaser"];
        var chaser_ref = doc(db, "data", chaser);
        var target = docSnap.data()["target"];
        var target_ref = doc(db, "data", target);
      } else {
        // doc.data() will be undefined in this case
        console.log("No such document!");
      }

//info about chaser
      const chaser_docSnap = await getDoc(chaser_ref);

      if (chaser_docSnap.exists()) {
          var tags = chaser_docSnap.data()["tags"] + 1;
        } else {
          // doc.data() will be undefined in this case
          console.log("No such document!");
        }

//change chaser data
      const chaser_docRef = await updateDoc(
        chaser_ref, {
          tags: tags,
          target: target
        }
      )
      .catch((error)=> {console.log(error)})

//change target data
  const target_docRef = await updateDoc(
    target_ref, {
      chaser: chaser,
    }
  )
  .catch((error)=> {console.log(error)})

  }

  async function set_target(){
    var ref = doc(db, "data", uid);
    const docSnap = await getDoc(ref);
    if (docSnap.exists()) {
        var target = docSnap.data()["target"];
        var target_ref = doc(db, "data", target);
      } else {
        // doc.data() will be undefined in this case
        console.log("No such document!");
      }
      const target_docSnap = await getDoc(target_ref);

      if (target_docSnap.exists()) {
          var first = target_docSnap.data()["firstName"] + " ";
          var last = target_docSnap.data()["lastName"];

        } else {
          // doc.data() will be undefined in this case
          console.log("No such document!");
        }
      document.getElementById('target').innerHTML = "<strong> Target: </strong>" + first + last;

    }

    set_target();

  tag_out.addEventListener('click', tag_out_func)

</script>
</body>
</html>
